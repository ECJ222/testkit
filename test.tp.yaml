---
- name: stage1
  stages:
    - request:
        POST: http://localhost:3000/todos
        headers:
          Content-Type: application/json
        json:
          number: 5
      asserts:
        ok: $.resp.json.number == 5
        ok: $.resp.status == 201
        number: $.resp.json.number
      outputs: null

- name: TODO api testing
  stages:
    - name: fetches TODO items - GET
      request:
        GET: http://localhost:3000/todos
      asserts:
        ok: $.resp.status == 200
        array: $.resp.json.tasks
        ok: $.resp.json.tasks[0] == "task one"
        number: $.resp.json.tasks[1]
        empty: $.resp.json.empty_str
        empty: $.resp.json.empty_arr
        null: $.resp.json.resp_null

    - name:  TODO ad items - POST
      request:
        POST: http://localhost:3000/todos
        headers:
            Content-Type: application/json
        json:
          task: "run tests"
      asserts:
        ok: $.resp.status == 201
      outputs:
        todoItem: $.resp.json.id

    - name: deletes TODO items - DELETE
      request:
        DELETE: "http://localhost:3000/todos/$.stages[1].outputs.todoItem"
      asserts:
        string: $.resp.json.task
        number: $.resp.json.id
        ok: $.resp.json.id == $.stages[-1].outputs.todoItem

    - name: Adds Todo item - POST
      request:
        POST: http://localhost:3000/todos/
        json:
          task: "run tests"
      asserts:
        ok: $.resp.status == 201
        ok: $.resp.json.task == "run tests"
        #ok: $.resp.json.completed
