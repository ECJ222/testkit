---
- name: TODO api testing
  stages:
    - name: fetches TODO items - GET
      request:
        GET: https://jsonplaceholder.typicode.com/posts
        headers:
            Content-Type: application/json
            Authorization: Bearer hidbjcbjknjknsjknjnbjfn
      asserts:
        - is_true: $.resp.status_code == 200
        - is_array: $.resp.body.json
      outputs:
        todoItem: $.resp.body.json[0]._id

    - name: deletes TODO items - DELETE
      request:
        DELETE: "/todos/{{$.stages[0].outputs.todoItem}}"
      asserts:
        - is_empty: $.resp.body.json.todos
        - is_string: $.resp.body.json

    - name: Adds Todo item - POST
      request:
        POST: /todos/
        json:
          task: "run tests"
      asserts:
        - is_true: $.resp.status_code == 200
        - is_true: $.resp.body.json.task == "run tests"
        - is_false: $.resp.body.json.completed
